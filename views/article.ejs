<!DOCTYPE HTML>

<html>
	<head>
		<title>GoogOL</title>
		<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="shortcut icon" type="image" href="/images/czym.png">
		
		<!-- Bootstrap Core CSS -->
		<link href="/stylesheets/bootstrap.min.css" rel="stylesheet">

		<!--[if lte IE 8]><script src="javascripts/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="/stylesheets/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="stylesheets/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="stylesheets/ie9.css" /><![endif]-->
	</head>
	<body class="left-sidebar">
		<div id="page-wrapper">

			<!-- Header -->
			<header id="header">
				<h1 id="logo"><a href="/"><span>STAY</span> FOOLISH</a></h1>
				<nav id="nav">
					<ul>
						<% if(!user){%>
							<li class="current"><a href="/">欢迎</a></li>
						<%}else{%>
							<li class="current"><a href="/">欢迎, <%=user.username%></a></li>
						<%}%>
						<li class="submenu">
							<a href="#">选项</a>
							<ul>
								<li><a href="/article.html">所有博客</a></li>
								<li><a href="/write.html">发布博客</a></li>
								<li><a href="/image.html">所有照片</a></li>
								<li><a href="/upload.html">上传照片</a></li>
								<li><a href="/logout">登出</a></li>
							</ul>
						</li>
						<%if(!user){%>
						<li><a href="/login.html" class="button special">登录</a></li>
						<%}%>
					</ul>
				</nav>
			</header>

			<!-- Main -->
				<article id="main">

					<header class="special container">
						<span class="icon fa-linux"></span>
						<h2>小窝纪事</h2>
						<p><!--[-->写我所想， 做我所爱<!--]--></p>
					</header>

					<!-- One -->
						<section class="wrapper style4 container">

							<div class="row 150%">
								<div class="4u 12u(narrower)">

									<!-- Sidebar -->
										<div class="sidebar">
											<section>
												<div class="list-group" >
													<a href="#" class="list-group-item" style="border: 0px solid transparent"><h3>最近博客</h3></a>
													<% for(var i = 0; i < data.length; i ++){ %>
													<a href="/article/<%=data[i].url%>" class="list-group-item" style="border: 0px solid transparent"><%=data[i].title%></a>
													<%}%>
													</div>
												
											</section>

											<section>
												<!-- <a href="#" class="image featured"><img src="images/pic03.jpg" alt="" /></a> -->
												<div class="list-group" >
													<a href="#" class="list-group-item" style="border: 0px solid transparent"><h3>博客分类</h3></a>
													<a href="/article/category/study" class="list-group-item" style="border: 0px solid transparent">学习</a>
													<a href="/article/category/life" class="list-group-item" style="border: 0px solid transparent">生活</a>
													<a href="/article/category/work" class="list-group-item" style="border: 0px solid transparent">工作</a>
													<a href="/article/category/other" class="list-group-item" style="border: 0px solid transparent">其他</a>
												</div>
											</section>
										</div>

								</div>
								<div class="8u 12u(narrower) important(narrower)">

									<!-- Content -->
										<div class="content">
											<section>
												<!-- <a href="#" class="image featured"><img src="images/pic02.jpg" alt="" /></a> -->
												
												<% if (articles !== -1){for (index in articles){%>
													
												<header>
													<a href="/article/<%=articles[index].url%>"><h3><%=articles[index].title%></h3></a>
													<br/>
												</header>
												<p><%for(var i = 0; i < articles[index].content.length; i ++){%>
													<%=articles[index].content[i]%><br/>
													<%}%>
												</p>
												<h6 style="text-align: right"><%=articles[index].time%></h6>
												<%}if(articles.length ===1 && articles[0].hasOwnProperty('comments')){if(articles[0].comments.length !== 0){%>
													<div class="row">
														<h5>《<%=articles[0].title%>》下的<%=articles[0].comments.length%>条评论：</h5>
													</div>
													<%}else{%>
													<div class="row">
														<h5>《<%=articles[0].title%>》下没有评论。</h5>
													</div>
												<div class="row">
												<%}for(var j = 0; j < articles[0].comments.length; j ++){%>
													
													<div class="12u">
														<div>
														<b class="6u" style="float: left"><%=articles[0].comments[j].email%>: </b>
														<span class="6u" style="font-size: small; float: right; text-align: right"><%=articles[0].comments[j].time%></span>
														</div>
													
														<div class="12u"><p ><%=articles[0].comments[j].content%></p>
															
														</div>
													</div>
											
													<%}%>
												</div>
												
												<div>
													<div>
														<h5>发表评论：</h5>
													</div>
													<div class="row " style="display: none">
														<div class="12u">
															<input type="text" name="articleId" id="articleId" readonly="readonly" style="display: none" value="<%=articles[0].url%>"/>
														</div>
													</div>
													<div class="row 50%">
														<div class="12u">
															<input type="email" name="email" id="email" placeholder="Email" />
														</div>
													</div>
													<div class="row 50%">
														<div class="12u">
															<textarea name="content" id= "content" placeholder="Content" rows="7"></textarea>
														</div>
													</div>
													<div class="row">
														<div class="12u" style="text-align: right">
															<p id="msg" style= "color: red"></p>
															<ul class="buttons">
																<li><input type="submit" class="btn btn-default" value="发表评论" style="min-width:8em; line-height:2.5em" onclick="comment()"/></li>
															</ul>
														</div>
													</div>
												</div>
												<!-- </form> -->
												<br/><br/>
												<%}} else{%>
												<header>
													<h3>欢迎来到Leo的小窝</h3>
												</header>
												<a href="#" class="image featured"><img src="/images/sylm.jpg" alt="" /></a>
												<p>哇！！！！石原小姐姐好漂亮！！！</p>
												<%}%>
											</section>
										</div>

								</div>
							</div>
						</section>

				</article>

			<!-- Footer -->
			<footer id="footer">

				<ul class="icons">
						<li><a href="https://twitter.com/casualture" class="icon circle fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="https://www.facebook.com/casualxg" class="icon circle fa-facebook"><span class="label">Facebook</span></a></li>
						<li><a href="https://github.com/FebFirst" class="icon circle fa-github"><span class="label">Github</span></a></li>
						<li><a href="https://www.youtube.com/channel/UC5mNVhrkWMFJ0vXFDXvBgqg?view_as=subscriber" class="icon circle fa-youtube"><span class="label">YouTube</span></a></li>
				</ul>
    
				<ul class="copyright">
					<li>Copyright &copy; 2018.leoxiong.cn All rights reserved.</li>
				</ul>
    
		</footer>
		</div>

			<!-- Scripts -->
			<script src="/javascripts/jquery.min.js"></script>
			<script src="/javascripts/jquery.dropotron.min.js"></script>
			<script src="/javascripts/jquery.scrolly.min.js"></script>
			<script src="/javascripts/jquery.scrollgress.min.js"></script>
			<script src="/javascripts/skel.min.js"></script>
			<script src="/javascripts/util.js"></script>
			<!--[if lte IE 8]><script src="javascripts/ie/respond.min.js"></script><![endif]-->
			<script src="/javascripts/main.js"></script>

			<!-- Bootstrap Core JavaScript -->
			<script src="/javascripts/bootstrap.min.js"></script>



			<script>
				function comment(){
					var articleId = $("#articleId").val();
					var email = $("#email").val();
					var content = $("#content").val();

					if(!articleId || !email || !content){
						document.getElementById("msg").innerHTML = "请按要求填写信息！";
						return;
					}
					var url = "/comment";
					var data = {"articleId": articleId, "email": email, "content": content};
					$.ajax({
					"type": "POST",
					"url": url,
					"contentType": "application/json",
					"data": JSON.stringify(data),
					"dataType": "json",
					"success":function (info) {
						// console.log(JSON.stringify(info));
						// console.log(info.ERROR);
						if(info.ERROR)
							document.getElementById("msg").innerHTML = info.ERROR;
						else{
							window.location.href = "/article/" + articleId;
						}
					}
				});
				}
			</script>
	</body>
</html>